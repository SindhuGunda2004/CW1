<!DOCTYPE html>
<html>

<head>
    <title>After School Adventures</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
        integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous" />
    <link rel="stylesheet" href="./AfterClass.css" type="text/css">
</head>

<body>
    <div id="app">
        <header class="navbar" style="display: flex; justify-content: space-between; align-items: center;">
            <p style="text-align: center; margin-left: 590px; font-size: 25px;">After School Adventures
                <button class="fas fa-cart-arrow-down"
                    style="margin-left: 500px; position: absolute; background-color: #ffe14c; border: none; border-radius: 2px solid; padding: 4px;"
                    v-on:click="toggleCartPage" :disabled="cartItemCount === 0">
                    {{cartItemCount}}
                </button>
            </p>
        </header>
        <div v-if="showProduct">
            <nav>
                <span class="searchbar"><input type="text" style="margin-left: 515px; font-size: 15px;"
                        placeholder="Search" v-model="searchVal">

                </span>
                <div class="sortby">
                    <label>Sort By:</label>
                    <select v-model="selectedSort">
                        <option value="price">Price</option>
                        <option value="subject">Subject</option>
                        <option value="location">Location</option>
                        <option value="availability">Availability</option>
                    </select>
                    <label style="margin-left: 15px;">Order By:</label>
                    <select v-model="selectedOrder">
                        <option value="AscDesc">Ascending to Descending</option>
                        <option value="DescAsc">Descending to Ascending</option>
                    </select>
                </div>
            </nav>

            <div class="products-container">
                <div v-for="product in filteredAndSortedProducts" class="product">
                    <div class="content">
                        <figure>
                            <img v-bind:src="product.image" height="100px" width="100px" alt="Product Image">
                        </figure>
                        <div class="text">
                            <p>Subject: {{product.subject}} </p>
                            <p>Location: {{product.location}}</p>
                            <p>Price: AED {{product.price}} </p>
                            <p>Slots Available: {{product.slotsAvailable - cartCount(product.id)}}</p>
                        </div>
                    </div>
                    <button v-on:click="addToCart(product)" v-if="canAddToCart(product)">
                        Add to Cart
                    </button>
                    <button disabled="disabled" v-else>
                        Add to Cart
                    </button>
                    <span v-if="product.slotsAvailable === cartCount(product.id)">All Out!</span>
                    <span v-else-if="product.slotsAvailable - cartCount(product.id) < 5">
                        Only {{product.slotsAvailable - cartCount(product.id)}} left!
                    </span>
                    <span v-else>Buy Now!!</span>
                </div>
            </div>
        </div>
        <div class="cartPage" v-else>
            <h2>Shopping Cart</h2>
            <div v-if="cartItemCount === 0">Your cart is empty.</div>
            <div v-else>
                <div class="products-container">
                    <div v-for="product in scart" class="product">
                        <div class="content">
                            <figure>
                                <img v-bind:src="getProductImage(product.id)" height="100px" width="100px"
                                    alt="Product Image">
                            </figure>
                            <div class="text">
                                <p>Subject: {{getProductSubject(product.id)}} </p>
                                <p>Price: {{ getProductPrice(product.id) }} </p>
                                <p>Location: {{ getProductLocation(product.id) }}</p>
                            </div>
                        </div>
                        <button v-on:click="removeFromCart(product.id)">Remove from Cart</button>
                    </div>
                </div>
                <p class="tprice">Total Price: {{ totalPrice }}</p>
                <div class="checkout">
                    <h2 style="font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif">Checkout
                    </h2>
                    <p>
                        Name:
                        <!-- this input field is bound to firstname in the order object -->
                        <input v-model.trim="order.Name">
                    </p>
                    <p>
                        Phone Number:
                        <!-- this input field is bound to lastname in the order object -->
                        <input type="number" v-model.trim="order.Phone">
                    </p>
                    <button class="placeOrd" v-on:click="submitForm" :disabled="!validateDetails">Place Order</button>
                </div>
            </div>
        </div>
    </div>
    <script src="classes.js"></script>
    <script type="text/javascript">

        let webstore = new Vue({
            el: "#app",
            data: {
                products: classes,
                selectedSort: '',
                selectedOrder: '',
                cart: [],
                scart: [],
                showProduct: true,
                cartIsEmpty: true,
                order: {
                    Name: "",
                    Phone: ""
                },
                searchVal: '',
            },
            methods: {
                addToCart: function (product) {
                    this.cart.push(product.id);
                    this.scart.push(product);
                    const productIndex = this.products.findIndex(p => p.id === product.id);
                    if (productIndex !== -1) {
                        this.products[productIndex].slotsAvailable--;
                    }
                },
                removeFromCart: function (productId) {
                    const index = this.scart.findIndex(product => product.id === productId);

                    if (index !== -1) {
                        const removedProduct = this.scart.splice(index, 1)[0];
                        const productIndex = this.products.findIndex(p => p.id === removedProduct.id);

                        if (productIndex !== -1) {
                            this.products[productIndex].slotsAvailable++;
                        }
                    }

                    this.cartIsEmpty = this.scart.length === 0;
                },
                toggleCartPage: function () {
                    this.showProduct = this.showProduct ? false : true;
                },
                cartCount(id) {
                    let count = 0;
                    for (let i = 0; i < this.scart.length; i++) {
                        if (this.scart[i] === id) {
                            count++;
                        }
                    }
                    return count;
                },
                canAddToCart: function (product) {
                    return product.slotsAvailable > this.cartCount(product.id);
                },
                getProductImage: function (productId) {
                    const product = this.products.find(p => p.id === productId);
                    return product ? product.image : '';
                },
                getProductSubject: function (productId) {
                    const product = this.products.find(p => p.id === productId);
                    return product ? product.subject : '';
                },
                getProductPrice: function (productId) {
                    const product = classes.find(p => p.id === productId);
                    return product ? product.price : 0;
                },
                getProductLocation: function (productId) {
                    const product = classes.find(p => p.id === productId);
                    return product ? product.location : '';
                },
                submitForm: function () {
                    alert("Purchase Completed\nYou're Enrolled in the subjects!!!!");
                    window.location.reload();
                }
            },
            computed: {
                cartItemCount: function () {
                    // return this.cart.length;
                    return this.scart.length;
                },
                totalPrice() {
                    return this.scart.reduce((total, product) => total + (this.getProductPrice(product.id) || 0), 0);
                },
                validateDetails: function () {
                    return /^[A-Za-z\s]+$/.test(this.order.Name) && /^[0-9]+$/.test(this.order.Phone);
                },
                filteredAndSortedProducts: function () {
                    let filteredList = this.products;

                    // Apply search filter
                    if (this.searchVal.trim().length > 0) {
                        filteredList = filteredList.filter((product) =>
                            product.subject.toLowerCase().includes(this.searchVal.trim().toLowerCase()) ||
                            product.location.toLowerCase().includes(this.searchVal.trim().toLowerCase())
                        );
                    }
                    // sorting
                    let sortedArray = filteredList.slice();
                    if (this.selectedSort == "price" && this.selectedOrder == "AscDesc") {
                        function compare(a, b) {
                            if (a.price > b.price)
                                return 1;
                            if (a.price < b.price)
                                return -1;
                            return 0;
                        }
                        return sortedArray.sort(compare);
                    }
                    if (this.selectedSort == "price" && this.selectedOrder == "DescAsc") {
                        function compare(a, b) {
                            if (a.price < b.price)
                                return 1;
                            if (a.price > b.price)
                                return -1;
                            return 0;
                        }
                        return sortedArray.sort(compare);
                    }
                    if (this.selectedSort == "location" && this.selectedOrder == "AscDesc") {
                        function compare(a, b) {
                            if (a.location > b.location)
                                return 1;
                            if (a.location < b.location)
                                return -1;
                            return 0;
                        }
                        return sortedArray.sort(compare);
                    }
                    if (this.selectedSort == "location" && this.selectedOrder == "DescAsc") {
                        function compare(a, b) {
                            if (a.location < b.location)
                                return 1;
                            if (a.location > b.location)
                                return -1;
                            return 0;
                        }
                        return sortedArray.sort(compare);
                    }
                    if (this.selectedSort == "subject" && this.selectedOrder == "AscDesc") {
                        function compare(a, b) {
                            if (a.subject > b.subject)
                                return 1;
                            if (a.subject < b.subject)
                                return -1;
                            return 0;
                        }
                        return sortedArray.sort(compare);
                    }
                    if (this.selectedSort == "subject" && this.selectedOrder == "DescAsc") {
                        function compare(a, b) {
                            if (a.subject < b.subject)
                                return 1;
                            if (a.subject > b.subject)
                                return -1;
                            return 0;
                        }
                        return sortedArray.sort(compare);
                    }
                    if (this.selectedSort == "availability" && this.selectedOrder == "AscDesc") {
                        function compare(a, b) {
                            if (a.slotsAvailable > b.slotsAvailable)
                                return 1;
                            if (a.slotsAvailable < b.slotsAvailable)
                                return -1;
                            return 0;
                        }
                        return sortedArray.sort(compare);
                    }
                    if (this.selectedSort == "availability" && this.selectedOrder == "DescAsc") {
                        function compare(a, b) {
                            if (a.slotsAvailable < b.slotsAvailable)
                                return 1;
                            if (a.slotsAvailable > b.slotsAvailable)
                                return -1;
                            return 0;
                        }
                        return sortedArray.sort(compare);
                    }
                    return sortedArray;
                }
            }
        });
    </script>

</body>

</html>